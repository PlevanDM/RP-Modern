#!/bin/bash

echo "╔═══════════════════════════════════════════════════════════════╗"
echo "║         ПОЛНАЯ ОСТАНОВКА ВСЕХ ПРОЦЕССОВ                       ║"
echo "╚═══════════════════════════════════════════════════════════════╝"

echo ""
echo "🛑 1. Остановка Docker контейнеров:"
echo "═══════════════════════════════════════════════════════════════"
docker compose down

echo ""
echo "🧹 2. Очистка Docker системы:"
echo "═══════════════════════════════════════════════════════════════"
docker system prune -af --volumes

echo ""
echo "🗑️ 3. Очистка временных файлов:"
echo "═══════════════════════════════════════════════════════════════"
find /root -name "*.log" -type f -delete 2>/dev/null || echo "Логи не найдены"
find /tmp -name "*repair-hub*" -type f -delete 2>/dev/null || echo "Временные файлы не найдены"

echo ""
echo "📊 4. Проверка статуса после очистки:"
echo "═══════════════════════════════════════════════════════════════"
docker ps -a

echo ""
echo "💾 5. Проверка использования диска:"
echo "═══════════════════════════════════════════════════════════════"
df -h

echo ""
echo "🔍 6. Проверка процессов:"
echo "═══════════════════════════════════════════════════════════════"
ps aux | grep -E "(nginx|node|docker)" | grep -v grep || echo "Процессы не найдены"

echo ""
echo "🎯 7. Проверка открытых портов:"
echo "═══════════════════════════════════════════════════════════════"
netstat -tulnp 2>/dev/null | grep -E ":80|:443|:3000" || echo "Порты не прослушиваются"

echo ""
echo "✅ 8. Финальный статус:"
echo "═══════════════════════════════════════════════════════════════"
echo "🌐 Сайт остановлен: https://repairhub.one"
echo "📦 Docker контейнеры: остановлены"
echo "🧹 Система: очищена"
echo "💾 Диск: $(df -h / | tail -1 | awk '{print $4}') свободно"

echo ""
echo "🔄 Для перезапуска выполните:"
echo "   cd /root/repair-hub-pro && git pull && docker compose up -d"

echo ""
echo "✅ ПОЛНАЯ ОСТАНОВКА ЗАВЕРШЕНА!"
